---
title: "Person Record Clustering with Fuzzy Matching"
description: "High-performance entity resolution system for clustering duplicate person records with variations in names, birthdates, and locations."
tags: ["Python", "Machine Learning", "Data Engineering", "Entity Resolution", "Graph Algorithms"]
cover: "/images/clustering.jpg"
date: "2024-10-14"
github: "https://github.com/wassil/clustering_fuzzy"
---

## Overview

A scalable entity resolution system designed to identify and cluster duplicate person records across large datasets (50,000+ records) with high accuracy and speed. The system handles real-world data quality issues including typos, date errors, and location changes.

### Key Features

- **Multi-field fuzzy matching** across names, birthdates, and locations
- **Phonetic blocking strategy** reduces comparisons by 99%+ (from 1.25B to ~250K)
- **Graph-based clustering** using connected components
- **Handles variations**: typos, phonetic similarities, date errors, location changes
- **High performance**: Processes 50k records in ~70 seconds

### Technical Stack

- **Fuzzy Matching**: Metaphone encoding, Jaro-Winkler distance, Token Sort Ratio
- **Graph Algorithms**: Connected components for transitive clustering
- **Data Processing**: Pandas, NumPy for efficient computation
- **Scalability**: O(n) blocking instead of O(n²) comparisons

### Architecture

The pipeline uses a 4-stage approach:

**1. Preprocessing**
- Normalize names (remove accents, lowercase)
- Parse dates with multiple format support
- Standardize location names

**2. Blocking Strategy**
- Group candidates by: `Metaphone(first_name) + birth_year ± 1`
- Secondary blocking: `Metaphone(last_name) + birth_year ± 1`
- Reduces comparisons from O(n²) to O(n)

**3. Fuzzy Matching**
- **Name similarity (50% weight)**: Token Sort Ratio + Jaro-Winkler
- **Date similarity (35% weight)**: Graduated scoring (exact → ±1 year)
- **Location similarity (15% weight)**: Fuzzy string matching
- Combined threshold: 0.75 for match classification

**4. Graph Clustering**
- Build similarity graph (records = nodes, matches = edges)
- Find connected components for transitive closure
- Each component represents one unique person

### Results

Performance on 50,000 records:
- **Preprocessing**: ~2 seconds
- **Blocking**: ~5 seconds (generates ~250k pairs from 1.25B possible)
- **Matching**: ~60 seconds (250k fuzzy comparisons)
- **Clustering**: ~3 seconds
- **Total runtime**: ~70 seconds

Accuracy metrics:
- **High precision**: Configurable threshold (0.70-0.85)
- **Handles edge cases**: Phonetic variations, date errors, relocations
- **Transitive clustering**: Ensures consistency across groups

### Implementation Highlights

**Blocking Optimization**
```python
# Instead of comparing all pairs (50k × 50k = 2.5B comparisons)
# Group by phonetic + temporal features
block_key = f"{metaphone(first_name)}_{birth_year}"
# Reduces to ~250k comparisons (99.99% reduction)
```

**Weighted Similarity Scoring**
- Name matching prioritized (50%) for identity
- Birthdate validation (35%) for verification
- Location as secondary signal (15%) due to mobility

**Graph-Based Clustering**
- Handles transitive relationships (A→B, B→C implies A→C)
- Ensures all duplicates of same person share cluster ID
- Single-pass clustering using union-find algorithm

### Use Cases

- **Data deduplication** in CRM and customer databases
- **Healthcare record linkage** across systems
- **Voter registration** cleaning and validation
- **Identity resolution** in data warehousing
- **Master data management** for person entities

The system balances accuracy and performance, making it suitable for production environments requiring regular batch processing of large-scale person datasets.
