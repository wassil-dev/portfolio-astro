---
import Layout from "../../layouts/Layout.astro";
import Navigation from "../../components/Navigation.astro";
import ProjectCard from "../../components/ProjectCard.astro";
import Footer from "../../components/Footer.astro";
import { getCollection } from "astro:content";

const base = import.meta.env.BASE_URL;

// Get all projects sorted by date
const projectsCollection = await getCollection("projects");
const projects = projectsCollection
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .map((p) => ({
    title: p.data.title,
    description: p.data.description || "",
    tech: p.data.tags || [],
    cover: p.data.cover || "",
    link: `${base}projects/${p.slug}/`
  }));

// Get unique tags
const allTags = [...new Set(projectsCollection.flatMap(p => p.data.tags))];
---

<Layout title="Projects - Ouassil Dahimene" description="Browse my portfolio of data analysis, fraud detection, and machine learning projects">
  <Navigation />
  <main class="min-h-screen">
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-primary/5 via-background to-background border-b border-border">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 sm:py-28">
        <div class="text-center space-y-6">
          <div class="inline-block">
            <div class="bg-gradient-to-r from-primary/20 to-primary/10 border border-primary/30 px-4 py-2 rounded-full text-sm font-semibold text-primary mb-4">
              ðŸš€ Projects
            </div>
          </div>
          <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight">
            <span class="bg-gradient-to-r from-foreground via-foreground/90 to-foreground/70 bg-clip-text text-transparent">
              My Work & Projects
            </span>
          </h1>
          <p class="text-xl text-muted-foreground max-w-2xl mx-auto leading-relaxed">
            Explore my portfolio of data science, machine learning, and analytics projects
          </p>
        </div>

        <!-- Tags Filter -->
        {allTags.length > 0 && (
          <div class="mt-12 flex flex-wrap justify-center gap-2">
            {allTags.map(tag => (
              <span class="bg-card border-2 border-border px-4 py-2 rounded-full text-sm font-medium text-foreground hover:border-primary/50 cursor-pointer transition-colors">
                {tag}
              </span>
            ))}
          </div>
        )}
      </div>
    </section>

    <!-- Projects Grid -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-20">
      {projects.length > 0 ? (
        <div class="grid gap-8 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
          {projects.map(project => (
            <ProjectCard {...project} />
          ))}
        </div>
      ) : (
        <div class="text-center py-20">
          <div class="text-6xl mb-4">ðŸš€</div>
          <h3 class="text-2xl font-bold text-foreground mb-2">No projects yet</h3>
          <p class="text-muted-foreground">Check back soon for new projects!</p>
        </div>
      )}
    </section>
  </main>
  <Footer />
</Layout>

<style>
  html {
    scroll-behavior: smooth;
  }
</style>
