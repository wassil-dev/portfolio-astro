---
import Layout from "../../layouts/Layout.astro";
import Navigation from "../../components/Navigation.astro";
import BlogCard from "../../components/BlogCard.astro";
import BlogSearch from "../../components/BlogSearch.astro";
import Footer from "../../components/Footer.astro";
import { getCollection } from "astro:content";

// Get all blog posts, filter out drafts, and sort by date
const allPosts = await getCollection("blog");
const posts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Get unique tags
const allTags = [...new Set(posts.flatMap(post => post.data.tags))];
---

<Layout title="Blog - Ouassil Dahimene" description="Read my thoughts on data analysis, fraud detection, machine learning, and more">
  <Navigation />
  <main class="min-h-screen">
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-primary/5 via-background to-background border-b border-border">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 sm:py-28">
        <div class="text-center space-y-6">
          <div class="inline-block">
            <div class="bg-gradient-to-r from-primary/20 to-primary/10 border border-primary/30 px-4 py-2 rounded-full text-sm font-semibold text-primary mb-4">
              üìù Blog
            </div>
          </div>
          <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight">
            <span class="bg-gradient-to-r from-foreground via-foreground/90 to-foreground/70 bg-clip-text text-transparent">
              Thoughts & Insights
            </span>
          </h1>
          <p class="text-xl text-muted-foreground max-w-2xl mx-auto leading-relaxed">
            Exploring data analysis, fraud detection, machine learning, and the latest in tech
          </p>
        </div>

        <!-- Tags Filter (Optional - can be enhanced with JS) -->
        {allTags.length > 0 && (
          <div class="mt-12 flex flex-wrap justify-center gap-2">
            {allTags.map(tag => (
              <span class="bg-card border-2 border-border px-4 py-2 rounded-full text-sm font-medium text-foreground hover:border-primary/50 cursor-pointer transition-colors">
                {tag}
              </span>
            ))}
          </div>
        )}
      </div>
    </section>

    <!-- Blog Posts Grid -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-20">
      <BlogSearch />

      {posts.length > 0 ? (
        <div class="grid gap-8 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
          {posts.map(post => (
            <div
              data-blog-card
              data-title={post.data.title}
              data-description={post.data.description}
              data-tags={post.data.tags.join(',')}
            >
              <BlogCard
                title={post.data.title}
                description={post.data.description}
                pubDate={post.data.pubDate}
                author={post.data.author}
                cover={post.data.cover}
                tags={post.data.tags}
                slug={post.slug}
              />
            </div>
          ))}
        </div>
      ) : (
        <div class="text-center py-20">
          <div class="text-6xl mb-4">üìù</div>
          <h3 class="text-2xl font-bold text-foreground mb-2">No posts yet</h3>
          <p class="text-muted-foreground">Check back soon for new content!</p>
        </div>
      )}
    </section>
  </main>
  <Footer />
</Layout>

<style>
  html {
    scroll-behavior: smooth;
  }
</style>
