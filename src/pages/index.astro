---
import Layout from "../layouts/Layout.astro";
import Navigation from "../components/Navigation.astro";
import ProjectCard from "../components/ProjectCard.astro";
import BlogCard from "../components/BlogCard.astro";
import SkillGrid from "../components/SkillGrid.astro";
import Timeline from "../components/Timeline.astro";
import Contact from "../components/Contact.astro";
import ContactForm from "../components/ContactForm.astro";
import AboutMe from "../components/AboutMe.astro";
import Certifications from "../components/Certifications.astro";
import GitHubStats from "../components/GitHubStats.astro";
import Footer from "../components/Footer.astro";

import skills from "../data/skills.json";
import experiences from "../data/experiences.json";
import contact from "../data/contact.json";
import about from "../data/about.json";
import certifications from "../data/certifications.json";

import { getCollection } from "astro:content";

// Load projects from Markdown collection
const projectsCollection = await getCollection("projects");

// Map each project to props for ProjectCard
const projects = projectsCollection.map((p) => ({
  title: p.data.title,
  description: p.data.description || "",
  tech: p.data.tags || [],
  cover: p.data.cover || "",
  link: `/projects/${p.slug}/` // Link to project page
}));

// Load blog posts (latest 3)
const allBlogPosts = await getCollection("blog");
const blogPosts = allBlogPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<Layout>
    <Navigation />
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Hero -->
      <header id="home" class="text-center space-y-8 py-20 sm:py-28">
        <div class="space-y-6">
          <div class="inline-block animate-bounce">
            <div class="bg-gradient-to-r from-primary/20 to-primary/10 border border-primary/30 px-4 py-2 rounded-full text-sm font-semibold text-primary mb-6">
              👋 Welcome to my portfolio
            </div>
          </div>
          <h1 class="text-3xl sm:text-5xl md:text-6xl lg:text-7xl font-extrabold tracking-tight px-2">
            <span class="bg-gradient-to-r from-foreground via-foreground/90 to-foreground/70 bg-clip-text text-transparent">
              Hi, I'm Ouassil Dahimene
            </span>
          </h1>
          <p class="text-base sm:text-xl md:text-2xl text-muted-foreground max-w-3xl mx-auto leading-relaxed px-4">
            Turning <span class="text-primary font-semibold">data into insights</span> and building systems that <span class="text-primary font-semibold">detect fraud</span> before it happens
          </p>
          <div class="flex flex-wrap justify-center gap-3 text-sm text-muted-foreground pt-2">
            <div class="flex items-center gap-2 bg-card border border-border px-4 py-2 rounded-full">
              <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              Data Analyst
            </div>
            <div class="flex items-center gap-2 bg-card border border-border px-4 py-2 rounded-full">
              <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
              Fraud Detection
            </div>
            <div class="flex items-center gap-2 bg-card border border-border px-4 py-2 rounded-full">
              <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
              </svg>
              ML Engineer
            </div>
          </div>
        </div>
        <div class="flex flex-wrap justify-center gap-4 pt-4">
          <a href="#projects" class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-all font-medium shadow-lg hover:shadow-xl hover:-translate-y-0.5">
            View Projects
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </a>
          <a href="#contact" class="inline-flex items-center gap-2 px-6 py-3 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80 transition-all font-medium border-2 border-border">
            Get in Touch
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
          </a>
        </div>
      </header>

      <!-- About Me -->
      <section id="about" class="py-16 sm:py-20">
        <div class="mb-16 text-center">
          <div class="inline-block mb-3">
            <span class="text-4xl">👨‍💻</span>
          </div>
          <h2 class="text-4xl sm:text-5xl font-bold mb-4 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent">
            About Me
          </h2>
          <p class="text-muted-foreground text-lg max-w-2xl mx-auto">
            Get to know me better and what drives my passion for data
          </p>
        </div>
        <AboutMe about={about} />
      </section>

      <!-- GitHub Stats -->
      <GitHubStats username="wassil-dev" />

      <!-- Projects -->
      <section id="projects" class="py-16 sm:py-20">
        <div class="mb-12 text-center sm:text-left">
          <div class="inline-block mb-3">
            <span class="text-4xl">🚀</span>
          </div>
          <h2 class="text-4xl sm:text-5xl font-bold mb-4 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent">
            Featured Projects
          </h2>
          <p class="text-muted-foreground text-lg max-w-2xl">
            A selection of my recent work in data analysis, fraud detection, and data engineering
          </p>
        </div>
        <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
          {projects.map((p) => (
            <ProjectCard {...p} />
          ))}
        </div>
      </section>

      <!-- Skills -->
      <section id="skills" class="py-16 sm:py-20">
        <div class="bg-muted/30 -mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8 py-16">
          <div class="max-w-7xl mx-auto">
          <div class="mb-12 text-center">
            <div class="inline-block mb-3">
              <span class="text-4xl">🛠</span>
            </div>
            <h2 class="text-4xl sm:text-5xl font-bold mb-4 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent">
              Skills & Technologies
            </h2>
            <p class="text-muted-foreground text-lg max-w-2xl mx-auto">
              Tools and technologies I use to bring ideas to life
            </p>
          </div>
          <SkillGrid skills={skills} />
          </div>
        </div>
      </section>

      <!-- Experience -->
      <section id="experience" class="py-16 sm:py-20">
        <div class="mb-12 text-center sm:text-left">
          <div class="inline-block mb-3">
            <span class="text-4xl">📈</span>
          </div>
          <h2 class="text-4xl sm:text-5xl font-bold mb-4 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent">
            Work Experience
          </h2>
          <p class="text-muted-foreground text-lg max-w-2xl">
            My professional journey and key accomplishments
          </p>
        </div>
        <Timeline experiences={experiences} />
      </section>

      <!-- Certifications -->
      <section id="certifications" class="py-16 sm:py-20">
        <div class="bg-muted/30 -mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8 py-16">
          <div class="max-w-7xl mx-auto">
          <div class="mb-12 text-center">
            <div class="inline-block mb-3">
              <span class="text-4xl">🏆</span>
            </div>
            <h2 class="text-4xl sm:text-5xl font-bold mb-4 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent">
              Certifications & Awards
            </h2>
            <p class="text-muted-foreground text-lg max-w-2xl mx-auto">
              Professional certifications and recognitions
            </p>
          </div>
          <Certifications certifications={certifications} />
          </div>
        </div>
      </section>

      <!-- Blog -->
      {blogPosts.length > 0 && (
        <section id="blog" class="py-16 sm:py-20">
          <div class="mb-12 text-center sm:text-left">
            <div class="inline-block mb-3">
              <span class="text-4xl">📝</span>
            </div>
            <h2 class="text-4xl sm:text-5xl font-bold mb-4 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent">
              Latest Blog Posts
            </h2>
            <p class="text-muted-foreground text-lg max-w-2xl">
              Thoughts and insights on data, technology, and more
            </p>
          </div>
          <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 mb-8">
            {blogPosts.map(post => (
              <BlogCard
                title={post.data.title}
                description={post.data.description}
                pubDate={post.data.pubDate}
                author={post.data.author}
                cover={post.data.cover}
                tags={post.data.tags}
                slug={post.slug}
              />
            ))}
          </div>
          <div class="text-center">
            <a href="/blog" class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-all font-medium shadow-lg hover:shadow-xl hover:-translate-y-0.5">
              View All Posts
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          </div>
        </section>
      )}

      <!-- Contact -->
      <section id="contact" class="py-16 sm:py-20 pb-24">
        <div class="mb-12 text-center">
          <div class="inline-block mb-3">
            <span class="text-4xl">📬</span>
          </div>
          <h2 class="text-4xl sm:text-5xl font-bold mb-4 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent">
            Let's Connect
          </h2>
          <p class="text-muted-foreground text-lg max-w-2xl mx-auto">
            Feel free to reach out for collaborations or just a friendly chat
          </p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 mb-12">
          <div class="w-full">
            <h3 class="text-xl md:text-2xl font-bold mb-4 md:mb-6">Get in Touch</h3>
            <ContactForm />
          </div>
          <div class="w-full">
            <h3 class="text-xl md:text-2xl font-bold mb-4 md:mb-6">Contact Information</h3>
            <Contact contact={contact} />
          </div>
        </div>
      </section>
    </main>
    <Footer />
</Layout>

<style>
  html {
    scroll-behavior: smooth;
  }
</style>
